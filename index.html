<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0f172a" />

  <title>Controle de Contas</title>

  <!-- Tailwind (utilit√°rios como flex/grid/gap/...) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel para transformar JSX no navegador (apenas para prot√≥tipo) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Evita flash branco ao carregar */
    html, body, #root { height: 100%; margin:0; }

    /* Evita o "pull-to-refresh" no mobile */
    html, body {
      overscroll-behavior-y: contain;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- novo: carregar o componente antes do script principal -->
  <script type="text/babel" src="./src/components/StyleTag.jsx"></script>
  <script type="text/babel" src="./src/components/PostLoginMock.jsx"></script>
  <script type="text/babel" src="./src/components/ContaCard.jsx"></script>
  <script type="text/babel" src="./src/components/EditPopup.jsx"></script>
  <script type="text/babel" src="./src/components/SettingsModal.jsx"></script>
  <script type="text/babel" src="./src/components/ReportsModal.jsx"></script>
  <script type="text/babel" src="./src/components/LoginGate.jsx"></script>
  <script type="text/babel" src="./src/components/App.jsx"></script>

    
  <script type="text/babel">

    function parseBRL(str){
      const s = String(str).replace(/[^\d,]/g, '').replace(/\.(?=\d)/g,'');
      return Number(s.replace(',', '.')) || 0;
    }

    function monthNamePT(m){
      return new Date(2025, m-1, 1).toLocaleString('pt-BR', { month:'long' }).replace(/^./, c=>c.toUpperCase());
    }

    function todayISO(){
      const d = new Date();
      return d.toISOString().slice(0,10); // yyyy-mm-dd
    }

    function parseBRtoISO(ddmmyyyy){
      const m = String(ddmmyyyy||'').match(/(\d{2})\/(\d{2})\/(\d{4})/);
      if (!m) return '';
      const [,dd,mm,yyyy] = m;
      return `${yyyy}-${mm}-${dd}`;
    }

    function CanvasPlaceholder({ aspect='16/9' }){
      return (
        <div className="w-full" style={{aspectRatio: aspect}}>
          <div className="w-full h-full" style={{
            borderRadius: 12,
            border: '1px dashed var(--border)',
            background: 'repeating-linear-gradient(45deg, rgba(255,255,255,.06) 0 8px, rgba(255,255,255,.02) 8px 16px)'
          }}/>
        </div>
      );
    }
    // Top 10 tipos de conta (mock)
    const COMMON_TYPES = ['Luz','Internet','Condom√≠nio','Escola','Celular','Empregada','Mercado','Cart√£o de Cr√©dito','G√°s'];

    
    // ====== Mount App ======
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
    const rootEl = document.getElementById('root');
    

  function getThemeClass() {
    const themed = rootEl.querySelector('.theme-gunmetal, .theme-synth, .theme-light');
    if (!themed) return null;
    return Array.from(themed.classList).find(c => /^theme-(gunmetal|synth|light)$/.test(c));
  }

  function syncTheme() {
    const cls = getThemeClass();
    document.body.classList.remove('theme-gunmetal','theme-synth','theme-light');
    if (cls) document.body.classList.add(cls);
  }
  
  // sincroniza agora e toda vez que mudar algo no subtree
  syncTheme();
  new MutationObserver(syncTheme).observe(rootEl, { attributes:true, childList:true, subtree:true });
  </script>
    <!-- === Gr√°ficos === -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

  <script type="module" src="./src/features/charts.js"></script>

  <!-- jsPDF para exportar m√∫ltiplos gr√°ficos em PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- PDF features -->
  <script src="./src/features/pdf.js"></script>



  <script type="module" src="./src/router.js"></script>
  <!-- novo: boot do router como m√≥dulo -->
  <script type="module" src="./src/data-adapter.js"></script>

  <script type="module">
    import { Router } from './src/router.js';
    window.Router = Router; // üëà torna global p/ o JSX

    Router.register('#/', () => {
      // rota default: cai na tela do m√™s atual (sem mudar estado)
      Router.go('#/mes');
    });

    Router.register('#/mes', (params) => {
      // aplica ano/mes na UI se vierem na URL
      window.AppRoutes?.mes(params);
    });

    Router.register('#/relatorios', () => {
      window.AppRoutes?.relatorios();
    });

    Router.start();
  </script>
  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", function () {
      navigator.serviceWorker
        .register("./sw.js")
        .then(function () {
          console.log("‚úÖ Service Worker registrado.");
        })
        .catch(function (err) {
          console.warn("‚ùå Service Worker falhou:", err);
        });
    });
  }
</script>


</body>
</html>
