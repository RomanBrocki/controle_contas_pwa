# üí∞ Controle de Contas PWA

Aplicativo web moderno para controle de contas dom√©sticas com **Supabase**, **React (UMD)**, **TailwindCSS** e **jsPDF/Chart.js**.  
Funciona inteiramente no navegador, sem build, usando scripts carregados via CDN.

---

## üèó Estrutura do Projeto

```text
‚îú‚îÄ index.html                         # ponto de entrada; carrega React UMD, Tailwind CDN e todos os JSX
‚îú‚îÄ src/
‚îÇ  ‚îú‚îÄ data-adapter.js                 # camada ‚Äúbonita‚Äù de dados: pega do Supabase e devolve no formato que a UI espera
‚îÇ  ‚îú‚îÄ router.js                       # SPA simples baseada em hash (#/mes, #/relatorios)
‚îÇ  ‚îú‚îÄ supabase/
‚îÇ  ‚îÇ  ‚îú‚îÄ client.js                    # inicializa o Supabase + exp√µe no window
‚îÇ  ‚îÇ  ‚îî‚îÄ queries.js                   # consultas e muta√ß√µes (contas, profile, listas distintas, √∫ltimos 12 meses, etc.)
‚îÇ  ‚îú‚îÄ features/
‚îÇ  ‚îÇ  ‚îú‚îÄ charts.js                    # helpers de gr√°ficos + ‚ÄúChartFeatures‚Äù usados no ReportsModal e nos PDFs
‚îÇ  ‚îÇ  ‚îî‚îÄ pdf.js                       # helpers de PDF (exporta 2 canvases por p√°gina, aplica tema PDF, etc.)
‚îÇ  ‚îî‚îÄ components/
‚îÇ     ‚îú‚îÄ StyleTag.jsx                 # temas (gunmetal, synth, light) + tokens para PDF + base dos modais
‚îÇ     ‚îú‚îÄ LoginGate.jsx                # login real (Supabase) + modo cadastro; espelha em window.MOCK_AUTH
‚îÇ     ‚îú‚îÄ PostLoginMock.jsx            # shell p√≥s-login (header, cards do m√™s, pend√™ncias, modais)
‚îÇ     ‚îú‚îÄ ContaCard.jsx                # card de cada conta do m√™s
‚îÇ     ‚îú‚îÄ EditPopup.jsx                # modal de criar/editar conta (com ‚ÄúOutro‚Ä¶‚Äù para pagador e links)
‚îÇ     ‚îú‚îÄ SettingsModal.jsx            # configura√ß√µes de perfil (email, tema, contas para gr√°ficos)
‚îÇ     ‚îú‚îÄ ReportsModal.jsx             # central de relat√≥rios: mensal, per√≠odo e comparativos
‚îÇ     ‚îî‚îÄ App.jsx                      # escolhe entre LoginGate e PostLoginMock e injeta StyleTag
```

---

## ‚öôÔ∏è Fluxo geral

1. **Login e sess√£o**
   - Autentica√ß√£o via Supabase Auth.
   - Ap√≥s login, o usu√°rio √© armazenado em `window.MOCK_AUTH` e `window.AppState`.
   - `AppState.profile` guarda tema, email e contas para gr√°ficos; √© atualizado sempre que o usu√°rio salva o perfil.

2. **Navega√ß√£o e exibi√ß√£o**
   - O `router.js` implementa hash-router (`#/mes`, `#/relatorios`), mas a navega√ß√£o atual ocorre por **modais** dentro de `PostLoginMock.jsx`.
   - Cards exibem as contas do m√™s atual, com acesso r√°pido a edi√ß√£o, pend√™ncias e relat√≥rios.

3. **Camada de dados e Supabase**
   - `supabase/client.js` inicializa o cliente com a **anon key**.
   - `supabase/queries.js` centraliza todo o CRUD (listagem, inser√ß√£o, update e delete).
   - `data-adapter.js` formata os dados para a UI, convertendo valores e datas.
   - Principais tabelas:

```sql
create table public.controle_contas (
  id bigint generated by default as identity primary key,
  ano bigint not null,
  mes bigint not null,
  nome_da_conta text not null,
  valor numeric not null,
  data_de_pagamento date not null,
  instancia text null,
  quem_pagou text not null,
  dividida boolean not null,
  link_boleto text null,
  link_comprovante text null,
  user_id uuid not null
);

create table public.profile (
  user_id uuid primary key,
  email text null,
  theme text null,
  chart_accounts text[] null
);
```

> üîí **Sugest√£o de seguran√ßa:**
> Ative RLS e adicione pol√≠ticas de acesso:
> ```sql
> create policy "user can access own data"
> on public.controle_contas for all
> using (auth.uid() = user_id);
>
> create policy "user can access own profile"
> on public.profile for all
> using (auth.uid() = user_id);
> ```

---

## üß© Componentes principais

### `LoginGate.jsx`
Tela de login e cadastro Supabase. Espelha credenciais em `window.MOCK_AUTH` e inicia sess√£o no app.

### `PostLoginMock.jsx`
Interface principal ap√≥s login ‚Äî exibe cards de contas, pend√™ncias e bot√µes de acesso √†s modais.

### `ContaCard.jsx`
Renderiza cada conta mensal, com visual limpo e campos para valor, inst√¢ncia, pagador e links.

### `EditPopup.jsx`
Modal de cria√ß√£o/edi√ß√£o de conta. Suporta sele√ß√£o din√¢mica de pagadores e links clic√°veis.

### `SettingsModal.jsx`
Gerencia **tema, email e contas exibidas nos relat√≥rios**.  
Salva ou cria automaticamente o `profile` no Supabase via `upsertProfile()`.

### `ReportsModal.jsx`
Central de relat√≥rios. Oferece:
- üìÖ Relat√≥rio mensal (pizza + barras + resumo + listagem com links clic√°veis);
- üìÜ Relat√≥rio por per√≠odo (pizza consolidada + linhas + listagens mensais);
- üìä Gr√°ficos comparativos com download em **PNG** ou **PDF**.

### `StyleTag.jsx`
Aplica tema global (Gunmetal, Synth ou Light). Tamb√©m define tokens usados na exporta√ß√£o de PDFs e gr√°ficos.

---

## üìà Gr√°ficos e PDFs

- `features/charts.js` define estilos e fun√ß√µes reutilizadas em todo o app.
- `features/pdf.js` exporta 2 canvases por p√°gina e aplica tema PDF-friendly (`__PDF_MODE`).
- Todos os gr√°ficos usam **Chart.js** e respeitam o tema ativo.
- PDFs s√£o gerados via **jsPDF**, com exporta√ß√£o autom√°tica em m√∫ltiplas p√°ginas.

### Fun√ß√µes principais
- `renderPizzaMensalStrict()` ‚Üí Pizza completa do m√™s com r√≥tulos externos e legenda detalhada.
- `renderBarrasMensalLocal()` ‚Üí Barras horizontais comparando m√™s atual, anterior e ano anterior.
- `renderLinhaPeriodoLocal()` ‚Üí Linhas temporais de uma conta ao longo de um per√≠odo.

---

## üíæ Sess√£o e persist√™ncia

- Sess√£o atual √© mantida em `window.MOCK_AUTH` e `window.AppState`.
- Logout limpa `authed` mas **preserva o tema** at√© o pr√≥ximo login.
- `profile` √© criado apenas no primeiro salvamento ‚Äî sem impacto de UX.

---

## üì± PWA e Deploy

Apesar do nome, o app ainda **n√£o possui manifest.json nem service worker**.  
O termo *PWA* refere-se √† abordagem client-side pura, que pode ser hospedada diretamente em **GitHub Pages** ou **Supabase Hosting**.

> ‚ö†Ô∏è **Aviso:** Tailwind √© carregado via CDN. O console exibe um aviso de produ√ß√£o (`cdn.tailwindcss.com should not be used in production`), mas n√£o afeta o funcionamento.

---

## üß∞ Tecnologias

- React 18 (UMD via CDN)  
- Supabase JS SDK  
- Chart.js 3.9  
- TailwindCSS (CDN)  
- jsPDF + pdf-lib  
- Babel Standalone (transforma√ß√£o JSX no navegador)

---

## üìà Roadmap

- [ ] Adicionar manifest.json e service worker reais (PWA completo).  
- [ ] Centralizar l√≥gica de PDF no m√≥dulo `pdf.js`.  
- [ ] Melhorar integra√ß√£o do router com navega√ß√£o interna.  
- [ ] Exporta√ß√£o adicional em CSV.  
- [ ] Configura√ß√£o visual avan√ßada de gr√°ficos (cores, estilos).

---

## üìú Licen√ßa

MIT ‚Äî uso livre, mantendo cr√©ditos originais.
