# Controle de Contas PWA (versão HTML + React UMD + Supabase)

Aplicação web para controle mensal de contas, com:

- autenticação via Supabase (com fallback/mirror em `window.MOCK_AUTH`);
- cadastro/edição de contas diretamente ligadas à tabela `public.controle_contas`;
- personalização de perfil (tema, e-mail e contas que vão para gráficos) na tabela `public.profile`;
- relatórios mensais e por período com **gráficos Chart.js**;
- exportação de gráficos para **PDF** via jsPDF;
- navegação SPA simples por **hash**.

É uma **PWA em construção** rodando 100% no navegador com Babel e recursos via CDN. A ideia aqui é ter um **protótipo funcional** que usa o mesmo backend que o app “sério” (Supabase), mas sem precisar de bundler.

---

## 1. Visão geral

O projeto foi montado para ser:

1. **Autocontido no navegador**: o `index.html` já carrega **React**, **ReactDOM**, **Tailwind**, **Chart.js**, **jsPDF** e os componentes JSX. Não precisa de build para rodar local.
2. **Acoplado ao Supabase**: todas as operações de dados (listar contas, inserir, atualizar, deletar, pegar perfil) passam por `src/supabase/queries.js`, que por sua vez usa o client único em `src/supabase/client.js`.
3. **Modular na UI**: cada pedaço da tela é um JSX separado em `src/components/`:
   - login
   - shell pós-login
   - card de conta
   - modal de edição
   - modal de configurações
   - modal de relatórios
4. **Com camada de “embelezamento de dados”**: `src/data-adapter.js` pega o que vem “feio” do banco (números, datas ISO, nomes de campos diferentes) e dá o formato que a UI espera (BRL, `dd/mm/yyyy`, objetos de links).
5. **Com temas e tokens centralizados**: `StyleTag.jsx` injeta os temas (`.theme-gunmetal`, `.theme-synth`, `.theme-light`) e também **as CSS vars usadas no modo PDF**.

---

## 2. Stack e motivo

- **React 18 (UMD)**: para não depender de Vite/Webpack enquanto você está iterando o layout.  
- **Babel no browser**: facilita alterar JSX rapidamente, mas **não é para produção** (o próprio console avisa).
- **Tailwind via CDN**: dá utilitário rápido sem precisar de build.
- **Supabase JS v2 (via ESM)**: `src/supabase/client.js` importa direto de `https://esm.sh/...` e já inicializa.
- **Chart.js 3.9.1 + plugins**: já ajustado para pizza com outlabels e barras comparativas.
- **jsPDF**: para gerar PDF com 2 gráficos por página.

Isso tudo está no **`index.html`**. Ele é o cérebro do “boot”.

---

## 3. Estrutura de pastas

```text
├─ index.html                         # ponto de entrada; carrega React UMD, Tailwind CDN e todos os JSX
├─ src/
│  ├─ data-adapter.js                 # camada “bonita” de dados: pega do Supabase e devolve no formato que a UI espera
│  ├─ router.js                       # SPA simples baseada em hash (#/mes, #/relatorios)
│  ├─ supabase/
│  │  ├─ client.js                    # inicializa o Supabase + expõe no window
│  │  └─ queries.js                   # consultas e mutações (contas, profile, listas distintas, últimos 12 meses, etc.)
│  ├─ features/
│  │  ├─ charts.js                    # helpers de gráficos + “ChartFeatures” usados no ReportsModal e nos PDFs
│  │  └─ pdf.js                       # helpers de PDF (exporta 2 canvases por página, aplica tema PDF, etc.)
│  └─ components/
│     ├─ StyleTag.jsx                 # temas (gunmetal, synth, light) + tokens para PDF + base dos modais
│     ├─ LoginGate.jsx                # login real (Supabase) + modo cadastro; espelha em window.MOCK_AUTH
│     ├─ PostLoginMock.jsx            # shell pós-login (header, cards do mês, pendências, modais)
│     ├─ ContaCard.jsx                # card de cada conta do mês
│     ├─ EditPopup.jsx                # modal de criar/editar conta (com “Outro…” para pagador e links)
│     ├─ SettingsModal.jsx            # configurações de perfil (email, tema, contas para gráficos)
│     ├─ ReportsModal.jsx             # central de relatórios: mensal, período e comparativos
│     └─ App.jsx                      # escolhe entre LoginGate e PostLoginMock e injeta StyleTag
```

---

## 4. Fluxo de execução

1. **`index.html` abre** → monta `<App />` no root.
2. **`App.jsx` decide se está logado** → verifica sessão no Supabase.
3. **`LoginGate.jsx`** → faz login/signup e espelha MOCK_AUTH.
4. **`PostLoginMock.jsx`** → lista contas e abre modais.
5. **`EditPopup` / `SettingsModal` / `ReportsModal`** → CRUD + gráficos + PDF.

---

## 5. Integração com Supabase

### Schema

```sql
create table public.controle_contas (
  id bigint generated by default as identity not null,
  ano bigint not null,
  mes bigint not null,
  nome_da_conta text not null,
  valor numeric not null,
  data_de_pagamento date not null,
  instancia text null,
  quem_pagou text not null,
  dividida boolean not null,
  link_boleto text null,
  link_comprovante text null,
  user_id uuid not null,
  constraint controle_contas_pkey primary key (id)
);

create table public.profile (
  user_id uuid not null,
  email text null,
  theme text null,
  chart_accounts text[] null,
  constraint profile_pkey primary key (user_id)
);
```

### Queries

Todas as funções estão em `src/supabase/queries.js` e usam o UID ativo do usuário (via MOCK_AUTH ou sessão real).

Principais:
- `listMes(ano, mes)` → busca contas do mês
- `insertConta(conta)` → adiciona nova conta
- `updateConta(id, conta)` → edita conta
- `deleteConta(id)` → exclui conta
- `getProfile()` / `upsertProfile()` → manipula o perfil

---

## 6. Componentes React

### `App.jsx`
Controla o estado de autenticação e o tema.

### `LoginGate.jsx`
Gerencia login e cadastro. Espelha o usuário logado em `window.MOCK_AUTH`.

### `PostLoginMock.jsx`
Shell principal pós-login: renderiza as contas, botões e modais.

### `ContaCard.jsx`
Renderiza visualmente uma conta (nome, valor, links).

### `EditPopup.jsx`
Modal de criação/edição com validações.

### `SettingsModal.jsx`
Configurações do perfil (tema e contas de gráfico).

### `ReportsModal.jsx`
Renderiza relatórios mensais e de período, integra com gráficos e PDF.

### `StyleTag.jsx`
Define temas, tokens de cor e estilos base da interface.

---

## 7. Gráficos e PDF

- `src/features/charts.js` → funções para pizza, barras e linhas (`ChartFeatures`).
- `src/features/pdf.js` → exporta 2 gráficos por página (A4) usando jsPDF.

---

## 8. Router (SPA Hash)

`src/router.js` → roteamento via `#/mes` e `#/relatorios`.  
Chamadas de rota acionam `window.AppRoutes.mes()` e `window.AppRoutes.relatorios()`.

---

## 9. Pontos de atenção

- Babel/Tailwind via CDN são apenas para protótipo.  
- Não atualizar Chart.js sem testar `chartjs-plugin-piechart-outlabels`.
- Logout **não apaga** `window.AppState.profile` (intencional).  
- Modo PDF precisa setar `window.__PDF_MODE = true` antes de renderizar.

---

## 10. Resumo / Portfólio

> **Controle de Contas PWA** é um protótipo funcional de um app de finanças pessoais que roda 100% no navegador usando React UMD e Supabase como backend. Ele permite cadastrar contas mensais, personalizar tema, gerar relatórios com gráficos Chart.js e exportar tudo para PDF.  
>  
> A arquitetura foi feita para depuração e ensino, com código modular, componentes JSX carregados via Babel e todas as integrações com Supabase centralizadas em um único arquivo (`queries.js`).
